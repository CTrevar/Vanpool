<div class="filtering">
	<!-- search form -->
	<form >
	  <div class="input-group">
	    <input type="text" placeholder="Buscar..." class="form-control" name="textoABuscar" id="textoABuscar" />
	    <span class="input-group-btn">
	      <button type="submit" id="btnBuscar" class="btn btn-flat">
	        <i class="fa fa-search"></i>
	      </button>
	    </span>
	  </div>
	</form>
	<!-- /.search form -->
</div>

<div id="conductorsTableContainer" class="col-lg-12 col-xs-12">
</div>

<script type="text/javascript" charset="utf-8">
        $(document).ready(function () {
            $('#conductorsTableContainer').jtable({
                messages: {
                    serverCommunicationError: 'Ocurri&oacute; un error al comunicarse con el servidor.',
                    loadingMessage: 'Cargando Registros...',
                    noDataAvailable: '&iexcl;No hay Datos!',
                    addNewRecord: 'Agregar condcutor',
                    editRecord: 'Editar conductor',
                    areYouSure: '¿Está seguro?',
                    deleteConfirmation: '&iquest;Est&aacute; seguro de eliminar este conductor?',
                    save: 'Guardar',
                    saving: 'Guardando',
                    cancel: 'Cancelar',
                    deleteText: 'Eliminar',
                    deleting: 'Eliminando',
                    error: 'Error',
                    close: 'Cerrar',
                    cannotLoadOptionsFor: 'No se pueden cargar las opciones para el campo {0}',
                    pagingInfo: 'Mostrando {0} a {1} de {2} conductores',
                    pageSizeChangeLabel: 'N&uacute;mero de registros',
                    gotoPageLabel: 'Ir a la p&aacute;gina',
                    canNotDeletedRecords: '&excl;No se pudieron eliminar {0} de {1} registros!',
                    deleteProgress: 'Eliminadas {0} de {1} administradores, procesando...'
                },
                title: 'Tabla de Conductores',
                useBootstrap: true,
                paging: true, //Habilitamos paginación.
                pageSize: 10, //Definimos el número de registros a mostrar a 10.
                sorting: true, //Habilitamos ordenación.
                defaultSorting: 'conductors.licenciaConductor ASC', //Definimos la columna default de ordenación.
                defaultDateFormat: 'yy-mm-dd',
                gotoPageArea: 'combobox',
                selecting: true, //Habilitar Seleccion.
                selectingCheckboxes: true, //Mostrar checkbox en la primer columna
                selectOnRowClick: true, //Habilitamos selección con la fila
                deleteConfirm: true,
                actions: {
                    //Aquí va el URL del método del controlador, debemos definirlos primero en config/routes.
                    listAction: '/conductor_controller/jtable_filterlist'
                },
                fields: {
                    //Columna en la tabla. Deben ponerse todas las columnas, si no deben ser visible, solamente
                    //habilitamos la opción list:false. Si un campo no debe editarse configuramos edit:false.
                    id: {
                        key: true,
                        list: false
                    },
                    name: {
                        title: 'Nombre',
                        width: '10%'
                    },
                    licenciaConductor: {
                        title: 'Licencia',
                        width: '10%'
                    },
                    email: {
                        title: 'email',
                        width: '20%'
                    },
                    idTipoUsuario: {
                        list: false,
                        edit: false,
                        create: false
                    },
                    facebookidUsuario: {
                        title: 'Facebook',
                        list: false,
                        edit: false,
                        create: false
                    },
                    openpayidUsuario: {
                        title: 'Openpay',
                        list: false,
                        edit: false,
                        create: false
                    },
                    apellidoPaterno: {
                        title: 'Apellido P',
                        width: '10%'
                    },
                    apellidoMaterno: {
                        title: 'Apellido M',
                        width: '10%'
                    },
                    fechaNacimiento: {
                        title: 'Nacimiento',
                        width: '10%',
                        list: false
                    },
                    estatusConductor: {
                        title: 'Estado',
                        width: '10%',
                        type: 'checkbox',
                        values: {'false':'Inactivo', 'true':'Activo'},
                        list: false,
                        edit: false
                    },
                    created_at: {
                        list: false,
                        edit: false,
                        create: false
                    },
                    updated_at: {
                        list: false,
                        edit: false,
                        create: false
                    }
                },
                //Se crea el evento de selectionchanged
                selectionChanged: function(){
                  	var $selectedRows = $("#conductorsTableContainer").jtable('selectedRows');
                  	if ($selectedRows.length > 0) {
                  		$selectedRows.each(function(){
                  			var record = $(this).data('record');
                  			$("#conductorId").val(record.id);
                  			$("#conductorNombre").val(record.name+" "+record.apellidoPaterno);
                  			$("#conductorLicencia").val(record.licenciaConductor);
                  		});
                  		
                  	}
                  	
                  }
            });
            //Realiza la búsqueda al presiona el botón de bsucar.
            $('#btnBuscar').click(function (e) {
                e.preventDefault();
                $('#conductorsTableContainer').jtable('load', {
                    textoABuscar: $('#textoABuscar').val()
                });
            });
            //Realiza la búsqueda al teclear en el campo de búsqueda si solo hay espacios, muestra todos los campos.
            $('#textoABuscar').keyup(function() {
                var texto = $('#textoABuscar').val();
                if(texto.trim().length == 0){
                    $('#conductorsTableContainer').jtable('load');
                }else{
                    $('#conductorsTableContainer').jtable('load', {
                        textoABuscar: $('#textoABuscar').val()
                    });
                }
            });
            // Esta línea carga los datos de la jTable al desplegar la página.
            $('#conductorsTableContainer').jtable('load');
        });
    </script>
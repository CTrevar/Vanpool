<% provide(:title, 'Sugerencias') %>
<%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?v=3.exp" %>
<%= stylesheet_link_tag "rutas", media: "all" %>
<script type="text/javascript">

</script>
<div class="wrapper row-offcanvas row-offcanvas-left">
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="left-side sidebar-offcanvas">
    <%= render 'shared/administrador_sidebar' %>
  </aside>

  <!-- Right side column. Contains the navbar and content of the page -->
  <aside class="right-side">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        <i class="fa fa-fw fa-inbox"></i>
        Sugerencias
      </h1>
      <ol class="breadcrumb">
        <li >Inicio</li>
        <li class="active">Sugerencias</li>
      </ol>
    </section>



    <!-- Main content -->
    <section class="content">


      <div class="row-fluid">
              <div class="col-md-6">
                        
                        <% if(@results.first!=nil)%>
                        <div class="slimScrollDiv" >
                            <%= will_paginate @results %>
                                <% @results.each do |result| %>
                                  <% sug_id = result[:id] %>
                                  <% result_cercanas = result[:sugerencias_cercanas]%>
                                    <div class="item-ruta border">
                                    <div class="row-fluid">
                                            <button class="btn btn-danger btn-sm pull-right" onclick="borrarSugerencia(#{sug_id}, #{result_cercanas})"><i class="fa fa-trash-o"></i> Borrar</button></br>
                                            <small class="label label-warning"><%= result[:numero_incidencias] %> incidencias</small></br>
                                            <small>ORIGEN:</small><b><%= result[:sugerencia].sugerenciaparadas.order('posicion ASC').first.nombre.split(",")[0] %></b></br>
                                            <small>DESTINO:</small><b><%= result[:sugerencia].sugerenciaparadas.order('posicion ASC').last.nombre.split(",")[0] %></b></br>
                                       
                                    </br>
                                          
                                          <%= link_to "Ver Detalle", '#', onclick: "mostrarDetalle(#{sug_id}, #{result_cercanas})", class: "btn btn-buscar-nav btn-flat span5 pull-right" %>
                                         
                                        </div>
                                    
                                    </div><!-- /.item -->
                            <% end %>
                            <%= will_paginate @results %>
                          </div> <!--lista sugs -->
                              <% else %>
                                <div class="item-ruta border">
                                    <h2>No hay sugerencias enviadas.</h2>
                                </div>
                            <% end %>
                          </br>
                    </div><!--columna-->
                    <div class= "col-md-6">
                      <div id="detalleSugerencia" style="display:none;"></di
                    </div> <!--column-->


      </div><!--row fluid-->
      

   

        <br/>
      <hr>

      <br />

     
    </section>

  </aside><!-- /.right-side -->
</div><!-- ./wrapper -->


<script type="text/javascript">
  
  function mostrarDetalle(sug_id, result){
    var data={
     sugerencia_id: sug_id,
     resultado: result
    };
    $.get('/administrador_detallesugerencia/', data, function(result){
                            $("#detalleSugerencia").html(result);
                        }).success();
                        $("#detalleSugerencia").show('fast');
                      
  }

  function borrarSugerencia(sug_id, result){
    var data={
     sugerencia_id: sug_id,
     cercanas_id: result
    };
    $.post('/borrar_sugerencia/', data, function(result){
              location.reload(true);
                        }).success();
    
  }

</script>
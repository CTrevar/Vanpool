function obtenerLocalizacion(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(mostrarPosicion)}function mostrarPosicion(t){currentLat=t.coords.latitude,currentLng=t.coords.longitude,map.setZoom(14),map.setCenter(new google.maps.LatLng(currentLat,currentLng))}function initialize(){if(obtenerLocalizacion(),currentLat)var t={zoom:30,center:new google.maps.LatLng(currentLat,currentLng)};else var t={zoom:14,center:new google.maps.LatLng(19.4329459,-99.1384108)};map=new google.maps.Map(document.getElementById("map-canvas"),t);var e={map:map,draggable:!0};directionsDisplay=new google.maps.DirectionsRenderer(e),google.maps.event.addListener(map,"click",function(t){arregloMarcadores.length<2&&agregarMarcador(t.latLng,2)}),autocompleteOrigen=new google.maps.places.Autocomplete(document.getElementById("origenRuta")),google.maps.event.addListener(autocompleteOrigen,"place_changed",function(){llenarDireccionAutocomplete(0)}),autocompleteDestino=new google.maps.places.Autocomplete(document.getElementById("destinoRuta")),google.maps.event.addListener(autocompleteDestino,"place_changed",function(){llenarDireccionAutocomplete(1)})}function agregarMarcador(t,e){var n="http://maps.google.com/mapfiles/kml/paddle/";if(0==e||0==contador)var i=new google.maps.MarkerImage(n+"grn-circle.png",null,null,null,new google.maps.Size(34,36));else var i=new google.maps.MarkerImage(n+"red-circle.png",null,null,null,new google.maps.Size(34,36));if(0==e&&arregloMarcadores[0])arregloMarcadores[0].setMap(null),arregloMarcadores[0].position=t,arregloMarcadores[0].setMap(map),obtenerDireccion(arregloMarcadores[0]);else if(1==e&&arregloMarcadores[1])arregloMarcadores[1].setMap(null),arregloMarcadores[1].position=t,arregloMarcadores[1].setMap(map),obtenerDireccion(arregloMarcadores[1]);else{var o=new google.maps.Marker({position:t,map:map,draggable:!0,icon:i});0==e||0==contador?arregloMarcadores[0]=o:(1==e||contador>0)&&(arregloMarcadores[1]=o),obtenerDireccion(o),google.maps.event.addListener(o,"dragend",function(){var t=arregloMarcadores.indexOf(o);arregloMarcadores[t]=o,obtenerDireccion(o)}),google.maps.event.addListener(o,"click",function(){obtenerDireccion(o),infowindow.setContent(dir),infowindow.open(map,this)})}2==arregloMarcadores.length&&(longit=(arregloMarcadores[0].getPosition().lng()+arregloMarcadores[1].getPosition().lng())/2,latit=(arregloMarcadores[0].getPosition().lat()+arregloMarcadores[1].getPosition().lat())/2,map.setCenter({lat:latit,lng:longit}),map.setZoom(map.getZoom()-1)),contador+=1}function borrarMarcadores(){if(arregloMarcadores)for(i in arregloMarcadores)arregloMarcadores[i].setMap(null)}function obtenerDireccion(t){geocoder.geocode({latLng:t.getPosition()},function(e,n){n==google.maps.GeocoderStatus.OK&&e[0]&&(dir=e[0].formatted_address,desplegarDireccion(dir,t))})}function desplegarDireccion(t,e){var n=arregloMarcadores.indexOf(e);0==n?(document.getElementById("origenRuta").value=t,document.getElementById("origenLat").value=e.getPosition().lat(),document.getElementById("origenLng").value=e.getPosition().lng()):(document.getElementById("destinoRuta").value=t,document.getElementById("destinoLat").value=e.getPosition().lat(),document.getElementById("destinoLng").value=e.getPosition().lng())}function llenarDireccionAutocomplete(t){if(0==t)var e=autocompleteOrigen.getPlace();else var e=autocompleteDestino.getPlace();agregarMarcador(e.geometry.location,t)}function agregarArrayMarcador(t){arregloMarcadores[0].position=t.legs[0].start_location,arregloMarcadores[1].position=t.legs[0].end_location}var map,arregloMarcadores=[],geocoder=new google.maps.Geocoder,infowindow=new google.maps.InfoWindow,dir,currentLat,currentLng,contador=0,placeSearch,autocompleteOrigen,autocompleteDestino;google.maps.event.addDomListener(window,"load",initialize);
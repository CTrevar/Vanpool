function obtenerLocalizacion(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(mostrarPosicion)}function mostrarPosicion(t){currentLat=t.coords.latitude,currentLng=t.coords.longitude,map.setCenter(new google.maps.LatLng(currentLat,currentLng))}function initialize(){if(obtenerLocalizacion(),currentLat)var t={zoom:13,center:new google.maps.LatLng(currentLat,currentLng)};else var t={zoom:13,center:new google.maps.LatLng(19.4329459,-99.1384108)};map=new google.maps.Map(document.getElementById("map-canvas"),t);var e={map:map,draggable:!0};directionsDisplay=new google.maps.DirectionsRenderer(e),google.maps.event.addListener(map,"click",function(t){agregarMarcador(t.latLng)}),google.maps.event.addListener(directionsDisplay,"directions_changed",function(){})}function agregarMarcador(t){var e=new google.maps.Marker({position:t,map:map,draggable:!0});arregloMarcadores.push(e),obtenerDireccion(e),google.maps.event.addListener(e,"dragend",function(){obtenerDireccion(e)}),google.maps.event.addListener(e,"click",function(){obtenerDireccion(e),infowindow.setContent(dir),infowindow.open(map,this)}),2==arregloMarcadores.length&&trazarRuta()}function borrarMarcadores(){if(arregloMarcadores)for(i in arregloMarcadores)arregloMarcadores[i].setMap(null)}function trazarRuta(){var t=arregloMarcadores[0].position,e=arregloMarcadores[arregloMarcadores.length-1].position,n=[];if(arregloMarcadores.length>2)for(i=1;i<arregloMarcadores.length-1;i++){var o=arregloMarcadores[i].position;n.push({location:o,stopover:!0})}var s={origin:t,destination:e,waypoints:n,travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC,optimizeWaypoints:!1};directionsService=new google.maps.DirectionsService;directionsService.route(s,function(t,e){if(e==google.maps.DirectionsStatus.OK){directionsDisplay.setDirections(t);{t.routes[0]}}else alert("no se pudo obtener direcciones")});borrarMarcadores()}function obtenerDireccion(t){geocoder.geocode({latLng:t.getPosition()},function(t,e){e==google.maps.GeocoderStatus.OK&&t[0]&&(dir=t[0].formatted_address,desplegarDireccion(dir))})}function desplegarDireccion(t){1==arregloMarcadores.length?document.getElementById("origenRuta").value=t:2==arregloMarcadores.length&&(document.getElementById("destinoRuta").value=t)}var map,arregloMarcadores=[],geocoder=new google.maps.Geocoder,infowindow=new google.maps.InfoWindow,dir,currentLat,currentLng,paradaId=0,contador=1;google.maps.event.addDomListener(window,"load",initialize);